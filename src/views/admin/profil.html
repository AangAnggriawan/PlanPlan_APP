<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Icon -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha384-H8R4b6PMtUwnNl/b6M7OCjL8aWMIj1hASMAQjDdq23a1VYjTGaK6hJVRbBzKkqI2" crossorigin="anonymous">
  <style>
    .fc-daygrid-day {
      border: 1px solid #ddd;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <title>Your Profile</title>
</head>
<body class="bg-sky-50">
  <header>
    <nav class="relative flex items-center justify-center w-full pt-5 bg-sky-50">
      <div class="left-[2%] top-[20%] absolute">
        <a type="button" id="go-back-btn" class="cursor-pointer">
          <img src="./svg/arrowback.svg" alt="" class="w-12">
        </a>
      </div>
      <div class="flex gap-2">
        <img class="w-14 md:w-20" src="./images/logo.jpg" alt="Logo Plan Plan">
        <span class="self-center hidden text-xl font-bold sm:block md:text-2xl whitespace-nowrap text-sky-900">Plan Plan</span>
      </div>
      <div class="right-[2%] top-[20%] absolute text-sky-100 rounded-xl p-2 bg-rose-800 hover:bg-rose-700">
        <button data-modal-target="popup-modal" data-modal-toggle="popup-modal" id="buttondelete" type="button" class="cursor-pointer flex justify-center text-center items-center">
          <svg class=" w-5 mr-1" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-person-x" viewBox="0 0 16 16">
            <path d="M11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0M8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4m.256 7a4.474 4.474 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10c.26 0 .507.009.74.025.226-.341.496-.65.804-.918C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4s1 1 1 1z"/>
            <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7m-.646-4.854.646.647.646-.647a.5.5 0 0 1 .708.708l-.647.646.647.646a.5.5 0 0 1-.708.708l-.646-.647-.646.647a.5.5 0 0 1-.708-.708l.647-.646-.647-.646a.5.5 0 0 1 .708-.708"/>
          </svg>
          <p class="font-semibold text-sky-100 text-sm">Delete User</p>
        </button>
      </div>
      <div class="right-[2%] top-[60%] absolute" >
        <p class="error-message text-rose-700 font-semibold text-center text-sm max-w-xs" id="Error_input_delete"></p>
        <p class="time" id="time"> </p>
      </div>
    </nav>
      <div id="popup-modal" tabindex="-1" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
        <div class="relative w-full max-w-md max-h-full">
            <div class="relative bg-sky-100 rounded-lg shadow ">
                <button type="button" class="absolute top-3 end-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center" data-modal-hide="popup-modal">
                    <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                    </svg>
                    <span class="sr-only">Close modal</span>
                </button>
                <div class="p-4 md:p-5 text-center" id="deleteakun">
                    <svg class="mx-auto mb-4 text-rose-800 w-12 h-12" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-exclamation-octagon" viewBox="0 0 16 16">
                      <path d="M4.54.146A.5.5 0 0 1 4.893 0h6.214a.5.5 0 0 1 .353.146l4.394 4.394a.5.5 0 0 1 .146.353v6.214a.5.5 0 0 1-.146.353l-4.394 4.394a.5.5 0 0 1-.353.146H4.893a.5.5 0 0 1-.353-.146L.146 11.46A.5.5 0 0 1 0 11.107V4.893a.5.5 0 0 1 .146-.353L4.54.146zM5.1 1 1 5.1v5.8L5.1 15h5.8l4.1-4.1V5.1L10.9 1z"/>
                      <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"/>
                    </svg>
                    <h3 class="mb-5 text-lg font-normal text-sky-900 ">Apakah kamu yakin ingin menghapus Akun ini?</h3>
                    <button data-modal-hide="popup-modal" id="deleteuser" type="button" class="text-sky-100 bg-red-600 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm inline-flex items-center px-5 py-2.5 text-center me-2" onclick="deleteuser()">
                        Iya, saya yakin
                    </button>
                    <button data-modal-hide="popup-modal" type="button" class="text-sky-100 bg-sky-900 hover:bg-sky-700 focus:ring-4 focus:outline-none focus:ring-gray-200 rounded-lg border border-sky-200 text-sm font-medium px-5 py-2.5 focus:z-10">Tidak, Batal</button>
                </div>
            </div>
        </div>
      </div>


  </header>

  <main id="" class="p-6 pb-10">
    <section class="pb-8">
      <div class="flex justify-center gap-14">
        <div class="flex items-end justify-start">
          <img src="./svg/awan.svg" alt="" class="h-10 lg:w-32 lg:h-20 w-22">
        </div>
        <div>
          <div class="flex flex-col items-center justify-center gap-5">
            <img src="./images/ilham.png" alt="" class="p-1 rounded-full shadow-xl w-36 h-36 md:w-48 md:h-48" style="box-shadow: 4px 4px 6px -6px #000000">
            <button class="flex items-center justify-center gap-2 px-3 py-2 font-bold border rounded-lg w-44 md:w-64 text-sky-50 bg-sky-900">
              <label for="addfile" class="flex items-center justify-center w-full cursor-pointer">
                <span class="material-symbols-outlined"> upload </span><p class="text-xs md:text-xl">Upload Foto Kamu</p>
              </label>
              <input type="file" name="" id="addfile" class="hidden" />
            </button>
          </div>
        </div>
        <div class="flex items-start justify-end">
          <img src="./svg/awan.svg" alt="" class="h-10 lg:w-32 lg:h-20 w-22">
        </div>
      </div>
    </section>

    <section class="pb-6">
      <div class="flex flex-col justify-center md:flex-row mx-auto gap-20 p-10 sm:w-[80%] lg:w-[70%] bg-sky-100 rounded-lg shadow-lg border border-sky-900" style="box-shadow: 7px 7px 6px -6px #000000">
        <form class="w-full md:w-[50%]" id="formchangepassword">
          <div class="mb-5">
            <label for="repeat-password" class="block mb-2 text-sm font-medium text-sky-900">Password Sekarang *</label>
            <input type="password" id="passwordnow" class="shadow-sm bg-gray-50 border border-gray-300 text-sky-900 text-sm rounded-lg focus:ring-sky-500 focus:border-sky-500 block w-full p-2.5" placeholder="********" required>
          </div>
          <div class="mb-5">
            <label for="repeat-password" class="block mb-2 text-sm font-medium text-sky-900">Password Baru *</label>
            <input type="password" id="passwordnew" class="shadow-sm bg-gray-50 border border-gray-300 text-sky-900 text-sm rounded-lg focus:ring-sky-500 focus:border-sky-500 block w-full p-2.5" placeholder="********" required>
          </div>
          <div class="mb-5">
            <label for="repeat-password" class="block mb-2 text-sm font-medium text-sky-900">konfirmasi Password Baru *</label>
            <input type="password" id="repeat-password" class="shadow-sm bg-gray-50 border border-gray-300 text-sky-900 text-sm rounded-lg focus:ring-sky-500 focus:border-sky-500 block w-full p-2.5" placeholder="********" required>
          </div>
          <div class=" my-2 flex justify-start" ><p class="error-message text-rose-700 font-semibold text-center text-sm max-w-xs" id="Error_input_password"></p></div>
          <button type="submit" class="text-sky-50 bg-green-700 hover:bg-green-600 focus:ring-4 focus:outline-none focus:ring-sky-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center" id="changepassword">Simpan password</button>
        </form>

        <form class="w-full md:w-[50%] flex flex-col gap-4" id="formdatauser">
          <div class="mb-5">
            <label for="nama" class="block mb-2 text-sm font-medium text-sky-900">Nama Pengguna *</label>
            <input type="text" id="username" class="shadow-sm bg-gray-50 border border-gray-300 text-sky-900 text-sm rounded-lg focus:ring-sky-500 focus:border-sky-500 block w-full p-2.5" placeholder="Nama Pengguna" required>
          </div>
          <div class="mb-5">
            <label for="email" class="block mb-2 text-sm font-medium text-sky-900">Email Pengguna *</label>
            <input type="email" id="emailuser" class="shadow-sm bg-gray-50 border border-gray-300 text-sky-900 text-sm rounded-lg focus:ring-sky-500 focus:border-sky-500 block w-full p-2.5" placeholder="Email@gmail.com" required>
          </div>
          <div>
            <label for="message" class="block mb-2 text-sm font-medium text-sky-900">Tentang Saya</label>
            <textarea id="deksripsiuser" rows="4" class="block p-2.5 w-full text-sm text-sky-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-green-500 focus:border-green-500" placeholder="Deskripsi Diri..... "></textarea>
          </div>
          <div class=" my-2 flex justify-end" ><p class="error-message text-rose-700 font-semibold text-center text-sm max-w-xs" id="Error_input_user"></p></div>
          <div class="flex justify-end">
            <button type="submit" class="text-white bg-green-700 hover:bg-gree-600 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center" id="simpanprofile">Simpan Profil</button>
          </div>
        </form>
      </div>
    </section>
  </main>

  <footer class="w-full shadow bg-sky-200">
    <div class="w-[98%] border border-t-black mx-auto max-w-screen-xl p-4 flex flex-col justify-center items-center sm:flex sm:flex-row sm:items-center sm:justify-between">
      <span class="text-sm text-sky-900">
        © 2023 <a class="hover:underline">PlanPlan™</a>. All Rights Reserved.
      </span>
      <ul class="flex flex-wrap items-center gap-3 mt-3 text-sm font-medium text-gray-500 border dark:text-gray-400 sm:mt-0">
        <li><a href="./indexdash.html#/tentangkita" class="text-sky-900">Tentang Kami</a></li>
        <li><a href="./indexdash.html#/tentangkita" class="text-sky-900">Contact</a></li>
      </ul>
    </div>
  </footer>

  <script>
    function myFunction() {
      var x = document.getElementById("myInput");
      if (x.type === "password") {
        x.type = "text";
      } else {
        x.type = "password";
      }
    }

    document.getElementById("go-back-btn").addEventListener("click", function() {
      window.history.back();
    });

    document.getElementById("formchangepassword").addEventListener("submit", function(e){
      e.preventDefault();
      updatepassword();
      document.getElementById('simpanprofile').setAttribute('disabled', true);
    });

    document.getElementById("formdatauser").addEventListener("submit", function(e){
      e.preventDefault();
      updatedatauser();
      document.getElementById('simpanprofile').setAttribute('disabled', true);
    });

    // change password
    async function updatepassword(){
      const passwordnow = document.getElementById('passwordnow').value;
      const passwordnew = document.getElementById('passwordnew').value;
      const confirmpasswordnew = document.getElementById('repeat-password').value;
      const tokenjwt = localStorage.getItem('token');
  
      const bodypassword = { 
        password: passwordnow, 
        new_password: passwordnew, 
        new_password_confirmation: confirmpasswordnew, 
      };
      console.log(bodypassword);
      const Urlupdatepass = 'https://be.gunz.my.id/user/password';

      axios.put(Urlupdatepass, bodypassword, {
        headers: {
          Authorization: `Bearer${tokenjwt}`,
        }
      }).then((response)=>{
          document.getElementById('simpanprofile').setAttribute('disabled', false);
          const Message = document.getElementById('Error_input_password');
          Message.innerHTML = response.data.message;
      }).catch((error)=>{
        const errorMessage = document.getElementById('Error_input_password');
        errorMessage.innerHTML = error.response.data.message;
      })
    }

    //update data user
    async function updatedatauser(){
      const username = document.getElementById('username').value;
      const emailuser = document.getElementById('emailuser').value;
      const deskripsi = document.getElementById('deksripsiuser').value;
      const image = document.getElementById('addfile').value;
      const urlupdateuser = 'https://be.gunz.my.id/user';
      const tokenjwt = localStorage.getItem('token');
      const bodyuser = {
        name: username,
        email: emailuser,
        description: deskripsi,
        profileImage: image,
      }
      console.log(bodyuser);
      axios.post(urlupdateuser, bodyuser, {
        headers: {
          Authorization: `Bearer ${tokenjwt}`,
        }
      }).then((response)=>{
          document.getElementById('simpanprofile').setAttribute('disabled', false);
          const Message = document.getElementById('Error_input_user');
          Message.innerHTML = response.data.message;
      }).catch((error)=>{
        const Message = document.getElementById('Error_input_user');
        Message.innerHTML = error.response.data.message;
      })
    }

    async function deleteuser(){
      const urldelete = 'https://be.gunz.my.id/user';
      const tokenjwt = localStorage.getItem('token');
      console.log(tokenjwt);
      axios.delete(urldelete, {
        headers: {
          Authorization: `Bearer ${tokenjwt}`,
        }
      }).then((response)=>{
        const Message = document.getElementById('Error_input_delete');
        Message.innerHTML = response.data.message;
        
        setTimeout(deleteakun, 5000);
        function deleteakun(){
          localStorage.removeItem('token');
          window.location.replace('/#/beranda')
        }
      }).catch((error)=>{
        const Message = document.getElementById('Error_input_delete');
        Message.innerHTML = error.response.data.message;
      })

    }
  </script>
</body>
</html>
